# Data Model: RAG Agent Construction

## Overview
Data models for the RAG agent system that processes user queries and generates answers based on content retrieved from the Qdrant vector store.

## Entity: User Query
**Description**: A question or request submitted by the user for the RAG agent to process
**Fields**:
- `query_text` (string): The user's question or request text
- `query_id` (string): Unique identifier for the query
- `timestamp` (datetime): When the query was submitted
- `user_context` (object, optional): Additional context about the user or session
- `metadata` (object, optional): Additional metadata for the query

**Validation rules**:
- `query_text` must not be empty
- `query_id` must be unique within the system
- `timestamp` must be in ISO 8601 format

## Entity: Retrieved Chunk
**Description**: A content chunk returned from the Qdrant vector store during processing
**Fields**:
- `text` (string): The retrieved text content
- `similarity_score` (float): The semantic similarity score (0.0 to 1.0)
- `metadata` (object): Metadata object containing:
  - `module` (string): The book module
  - `page` (string): The page title
  - `heading` (string): The section heading
  - `url` (string): The source URL
  - `title` (string): The page title
- `vector_id` (string): The unique identifier in the vector store
- `source_reference` (string): Formatted reference to the source location

**Validation rules**:
- `text` must not be empty
- `similarity_score` must be between 0.0 and 1.0
- `vector_id` must match expected format
- `metadata` must contain all required fields

## Entity: Generated Response
**Description**: The final answer generated by the agent based on retrieved content
**Fields**:
- `response_text` (string): The generated answer text
- `response_id` (string): Unique identifier for the response
- `query_id` (string): Reference to the original query
- `retrieved_chunks` (array of objects): Array of chunks that informed the response
- `source_references` (array of strings): Formatted references to source materials
- `confidence_score` (float): Confidence level in the response accuracy (0.0 to 1.0)
- `timestamp` (datetime): When the response was generated
- `grounding_validation` (object): Results of grounding validation:
  - `is_valid` (boolean): Whether the response is properly grounded
  - `validation_issues` (array of strings): Any issues found during validation

**Validation rules**:
- `response_text` must not be empty
- `confidence_score` must be between 0.0 and 1.0
- `retrieved_chunks` array must contain at least one valid chunk
- `grounding_validation.is_valid` must be true for valid responses

## Entity: API Request
**Description**: The structure of requests to the RAG agent API
**Fields**:
- `query` (string): The user's question or request
- `max_tokens` (integer, optional): Maximum tokens for the response (default: 500)
- `temperature` (float, optional): Temperature for response generation (default: 0.7)
- `include_sources` (boolean, optional): Whether to include source references (default: true)
- `session_id` (string, optional): Session identifier for conversation history

**Validation rules**:
- `query` must not be empty
- `max_tokens` must be between 1 and 2000
- `temperature` must be between 0.0 and 1.0

## Entity: API Response
**Description**: The structure of responses from the RAG agent API
**Fields**:
- `query` (string): Echo of the original query
- `answer` (string): The generated answer
- `sources` (array of objects): Array of source references used in the answer:
  - `text` (string): Snippet of the source text
  - `url` (string): URL to the source
  - `page` (string): Page/module reference
- `confidence` (float): Confidence score for the answer
- `retrieval_stats` (object): Statistics about the retrieval process:
  - `chunks_retrieved` (integer): Number of chunks retrieved
  - `processing_time_ms` (float): Time taken for processing
- `query_id` (string): Unique identifier for the query

**Validation rules**:
- `answer` must not be empty
- `confidence` must be between 0.0 and 1.0
- `sources` array must contain valid source references if `include_sources` was true
- `retrieval_stats.processing_time_ms` must be positive

## Entity: Health Status
**Description**: Health check response for the service
**Fields**:
- `status` (string): Overall service status (healthy, degraded, unavailable)
- `timestamp` (datetime): When the status was checked
- `services` (object): Status of dependent services:
  - `qdrant` (string): Status of Qdrant connection (connected, disconnected)
  - `openai` (string): Status of OpenAI API connection (connected, disconnected)
- `response_time_ms` (float): Time taken to perform health check

**Validation rules**:
- `status` must be one of "healthy", "degraded", or "unavailable"
- `response_time_ms` must be positive
- `services` must contain status for all required services